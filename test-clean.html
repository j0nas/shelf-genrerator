<!DOCTYPE html>
<html>
<head>
    <title>Test Clean XState Architecture</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #three-canvas { width: 800px; height: 600px; border: 1px solid #ccc; }
        .controls { margin: 20px 0; }
        button { margin: 5px; padding: 10px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; height: 200px; overflow-y: scroll; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Clean XState Divider System Test</h1>
    
    <div id="three-canvas"></div>
    
    <div class="controls">
        <button onclick="runTest()">Run State Machine Test</button>
        <button onclick="clearLog()">Clear Log</button>
        <button onclick="inspectState()">Inspect State</button>
    </div>
    
    <div id="log" class="log"></div>
    
    <script type="module">
        import { testCleanArchitecture } from './dist/js/test-clean-architecture.js';
        import { DividerSystem } from './dist/js/divider-system.js';
        
        let dividerSystem;
        let log = document.getElementById('log');
        
        // Override console.log to show in UI
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            log.innerHTML += args.join(' ') + '<br>';
            log.scrollTop = log.scrollHeight;
        };
        
        // Initialize the clean system
        console.log('üöÄ Initializing Clean XState Divider System...');
        
        try {
            dividerSystem = new DividerSystem('three-canvas');
            
            // Set up test shelf config
            dividerSystem.updateShelfConfig({
                width: 36,
                height: 72,
                depth: 12,
                materialThickness: 0.75,
                materialType: 'plywood',
                units: 'imperial',
                backPanel: false,
                edgeTreatment: 'none',
                woodGrain: true
            });
            
            console.log('‚úÖ Clean system initialized successfully!');
            console.log('üìù Try clicking on the 3D shelf to add dividers');
            console.log('üìù Click near the edges for vertical dividers');
            console.log('üìù Click in the center for horizontal dividers');
            
        } catch (error) {
            console.error('‚ùå Error initializing system:', error);
        }
        
        window.runTest = function() {
            console.log('\nüß™ Running state machine unit test...');
            testCleanArchitecture();
        };
        
        window.clearLog = function() {
            log.innerHTML = '';
        };
        
        window.inspectState = function() {
            if (dividerSystem) {
                const state = dividerSystem.getState();
                console.log('\nüîç Current State:', JSON.stringify(state.value));
                console.log('üîç Context:', state.context);
                console.log('üîç All Dividers:', dividerSystem.getAllDividers());
            }
        };
        
        // Make available globally for debugging
        window.dividerSystem = dividerSystem;
    </script>
</body>
</html>